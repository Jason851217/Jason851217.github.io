<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="learningcenter">
<meta name="keywords" content="learningcenter">
<meta property="og:type" content="website">
<meta property="og:title" content="Jason的博客">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Jason的博客">
<meta property="og:description" content="learningcenter">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Jason的博客">
<meta name="twitter:description" content="learningcenter">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>Jason的博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Jason的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Jason‘s LearningCenter</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            站点地图
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/23/Mac修改Launchpad启动器图标行列的数量/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason.Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/23/Mac修改Launchpad启动器图标行列的数量/" itemprop="url">Mac修改Launchpad启动器图标行列的数量</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-23T11:12:24+08:00">
                2018-07-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mac/" itemprop="url" rel="index">
                    <span itemprop="name">mac</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="修改MAC中Launchpad启动器图标行列的数量"><a href="#修改MAC中Launchpad启动器图标行列的数量" class="headerlink" title="修改MAC中Launchpad启动器图标行列的数量"></a>修改MAC中Launchpad启动器图标行列的数量</h1><h2 id="改变行数"><a href="#改变行数" class="headerlink" title="改变行数"></a>改变行数</h2><p>  defaults write com.apple.dock springboard-rows -int 7</p>
<h2 id="改变列数"><a href="#改变列数" class="headerlink" title="改变列数"></a>改变列数</h2><p>  defaults write com.apple.dock springboard-columns -int 10</p>
<h2 id="使改变生效"><a href="#使改变生效" class="headerlink" title="使改变生效"></a>使改变生效</h2><p>  killall Dock</p>
<h2 id="恢复默认"><a href="#恢复默认" class="headerlink" title="恢复默认"></a>恢复默认</h2><p>  defaults write com.apple.dock springboard-rows Default</p>
<p>  defaults write com.apple.dock springboard-columns Default</p>
<p>  killall Dock</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/23/AOP中的匹配切点表达式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason.Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/23/AOP中的匹配切点表达式/" itemprop="url">Spring AOP中的匹配切点表达式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-23T11:02:57+08:00">
                2018-07-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring/" itemprop="url" rel="index">
                    <span itemprop="name">Spring</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br></pre></td><td class="code"><pre><span class="line">package cn.timebusker.aop;</span><br><span class="line"></span><br><span class="line">import org.aspectj.lang.JoinPoint;</span><br><span class="line">import org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line">import org.aspectj.lang.Signature;</span><br><span class="line">import org.aspectj.lang.annotation.After;</span><br><span class="line">import org.aspectj.lang.annotation.AfterReturning;</span><br><span class="line">import org.aspectj.lang.annotation.AfterThrowing;</span><br><span class="line">import org.aspectj.lang.annotation.Around;</span><br><span class="line">import org.aspectj.lang.annotation.Aspect;</span><br><span class="line">import org.aspectj.lang.annotation.Before;</span><br><span class="line">import org.aspectj.lang.annotation.Pointcut;</span><br><span class="line">import org.slf4j.Logger;</span><br><span class="line">import org.slf4j.LoggerFactory;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">import com.alibaba.fastjson.JSON;</span><br><span class="line"></span><br><span class="line">import cn.timebusker.utils.DateUtil;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 面向切面编程 主要功能：日志记录、性能统计、安全控制、事务处理、异常处理等等</span><br><span class="line"> */</span><br><span class="line">@Component</span><br><span class="line">@Aspect</span><br><span class="line">//使用 order对多个切面进行排序,参数越小，越在前</span><br><span class="line">@Order(1)</span><br><span class="line">public class LoggerHandlerAop &#123;</span><br><span class="line"></span><br><span class="line">	private final static Logger logger = LoggerFactory.getLogger(LoggerHandlerAop.class);</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * AOP切面中的同步问题：用于监控业务处理性能</span><br><span class="line">	 */</span><br><span class="line">	ThreadLocal&lt;Long&gt; startTime = new ThreadLocal&lt;&gt;();</span><br><span class="line"></span><br><span class="line">// ==========================================================匹配切点表达式========================================================================================</span><br><span class="line">/**</span><br><span class="line"> * 一、execution(方法表达式)</span><br><span class="line"> * 1、匹配方法时，只能匹配到实现类，匹配到接口类不能成功</span><br><span class="line"> * 2、匹配方法执行</span><br><span class="line"> */</span><br><span class="line">	// 匹配cn.timebusker.service包及子包下的任何方法执行</span><br><span class="line">	@Pointcut(value=&quot;execution(* cn.timebusker.service.*.*(..))&quot;)</span><br><span class="line">	public void log1() &#123;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	// 匹配任何包下的service包及子包下的任何方法执行(该模式只能匹配到一级的子包，多级子包不适用)</span><br><span class="line">	@Pointcut(value=&quot;execution(* *..service.*.*(..))&quot;)</span><br><span class="line">	public void log2() &#123;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	// 匹配任何包下的service包及子包下的任何方法执行(该模式能匹配到任何多级的子包下的方法执行)</span><br><span class="line">	@Pointcut(value = &quot;execution(* *..service..*(..))&quot;)</span><br><span class="line">	public void log3() &#123;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	// 匹配返回值类型为java.lang.String的任何包下的service包及子包下的方法执行</span><br><span class="line">	@Pointcut(value = &quot;execution(java.lang.String *..service..*(..))&quot;)</span><br><span class="line">	public void log4() &#123;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	// 匹配返回值类型为int的任何包下的service包及子包下的方法执行</span><br><span class="line">	@Pointcut(value = &quot;execution(int *..service..*(..))&quot;)</span><br><span class="line">	public void log5() &#123;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	// 匹配任何返回值类型的cn.timebusker包及任何子包下的以add开头的参数为Strign类型的方法执行</span><br><span class="line">	@Pointcut(value = &quot;execution(* cn.timebusker..add*(String))&quot;)</span><br><span class="line">	public void log6() &#123;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	// 匹配 OR、AND</span><br><span class="line">	@Pointcut(value = &quot;execution(* cn.timebusker.service.*.add*(int))&quot;)</span><br><span class="line">	public void log7() &#123;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	// 匹配 OR、AND、</span><br><span class="line">	@Pointcut(value = &quot;execution(* cn.timebusker.service.*.add*(int)) OR execution(* cn.timebusker..add*(String))&quot;)</span><br><span class="line">	public void log8() &#123;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">/**</span><br><span class="line"> * 二、within(类型表达式)</span><br><span class="line"> * 1、匹配类型时，只能匹配到实现类，匹配到接口类不能成功</span><br><span class="line"> * 2、匹配指定类型内的方法执行；</span><br><span class="line"> */</span><br><span class="line">	// 匹配指定类型内的方法执行--只能匹配类型</span><br><span class="line">	@Pointcut(value = &quot;within(cn.timebusker.service.order.Impl.OrderInfoServiceImpl)&quot;)</span><br><span class="line">	public void logw1() &#123;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	// 匹配指定类型内的方法执行(包下所有的类)</span><br><span class="line">	@Pointcut(value = &quot;within(cn.timebusker.service.order.Impl.*)&quot;)</span><br><span class="line">	public void logw2() &#123;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 三、this(类型全限定名)</span><br><span class="line"> * 1、可以直接匹配接口类型完成  类型全名限定匹配</span><br><span class="line"> * 2、注意是AOP代理对象的类型匹配，这样就可能包括引入接口方法也可以匹配；注意this中使用的表达式必须是类型全限定名，不支持通配符</span><br><span class="line"> */</span><br><span class="line">	// 匹配指定类型内的方法执行(包下所有的类)</span><br><span class="line">	@Pointcut(value = &quot;this(cn.timebusker.service.order.OrderInfoService)&quot;)</span><br><span class="line">	public void logt1() &#123;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">/**</span><br><span class="line">* 四、target(类型全限定名)--匹配当前目标对象类型的执行方法</span><br><span class="line">* 1、可以直接匹配接口类型完成  类型全名限定匹配</span><br><span class="line">* 2、注意是目标对象的类型匹配，这样就不包括引入接口也类型匹配；注意target中使用的表达式必须是类型全限定名，不支持通配符</span><br><span class="line">*/</span><br><span class="line">		// 匹配指定类型内的方法执行(包下所有的类)</span><br><span class="line">		@Pointcut(value = &quot;target(cn.timebusker.service.order.OrderInfoService)&quot;)</span><br><span class="line">		public void logt2() &#123;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">/**</span><br><span class="line">* 五、args(参数类型列表)--匹配当前执行的方法传入的参数为指定类型的执行方法</span><br><span class="line">* 1、注意是匹配传入的参数类型，不是匹配方法签名的参数类型；参数类型列表中的参数必须是类型全限定名，通配符不支持；</span><br><span class="line">* 2、args属于动态切入点，是在运行时动态匹配的，这种切入点开销非常大，非特殊情况最好不要使用；</span><br><span class="line">* 3、此处不作示例</span><br><span class="line">*/</span><br><span class="line">		</span><br><span class="line">/**</span><br><span class="line">* 六、@within(注解类型)--匹配所以持有指定注解类型内的方法；注解类型也必须是全限定类型名；</span><br><span class="line">* 1、注解类型也必须是全限定类型名;</span><br><span class="line">*/</span><br><span class="line">		// 匹配被org.springframework.stereotype.Service这个注解标注的类----注解标注在接口上不起作用</span><br><span class="line">		@Pointcut(value = &quot;@within(org.springframework.stereotype.Service)&quot;)</span><br><span class="line">		public void logaw1() &#123;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		// 匹配 自定义注解标注的类----注解标注在接口上不起作用</span><br><span class="line">		@Pointcut(value = &quot;@within(cn.timebusker.annotation.timebuskerBean)&quot;)</span><br><span class="line">		public void logaw2() &#123;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">/**</span><br><span class="line">* 七、@target(注解类型)--匹配当前目标对象类型的执行方法</span><br><span class="line">* 1、目标对象持有指定的注解；</span><br><span class="line">* 2、注解类型也必须是全限定类型名；</span><br><span class="line">* 3、此处不作示例</span><br><span class="line">*/		</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">* 八、@annotation(注解类型)--匹配当前执行方法持有指定注解的方法</span><br><span class="line">* 1、注解类型也必须是全限定类型名；</span><br><span class="line">*/	</span><br><span class="line">		// 匹配 自定义注解标注的类----注解标注在接口的方法上不起作用</span><br><span class="line">		@Pointcut(value = &quot;@annotation(cn.timebusker.annotation.timebuskerMethod)&quot;)</span><br><span class="line">		public void logaa1() &#123;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">// ==========================================================匹配切点表达式========================================================================================</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 前置通知：在连接点执行前的通知，但不能阻止连接点前的执行（除非它抛出一个异常）</span><br><span class="line">	 */</span><br><span class="line"></span><br><span class="line">// 引用多个切入点</span><br><span class="line">//	@Before(&quot;log6() OR log7()&quot;)</span><br><span class="line">// 引用单个切入点</span><br><span class="line">	@Before(&quot;logaa1()&quot;)</span><br><span class="line">	public void beforeAdvice(JoinPoint point) &#123;</span><br><span class="line">		logger.info(&quot;SSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS&quot;);</span><br><span class="line">		logger.info(&quot;LoggerHandlerAop.beforeAdvice...time:&quot; + DateUtil.now());</span><br><span class="line">		Signature signature = point.getSignature();</span><br><span class="line">		logger.info(&quot;所属类名称：&quot; + signature.getDeclaringTypeName() + &quot;\n代理类：&quot; + signature.getClass() + &quot;\n方法名称：&quot; + signature.getName() + &quot;\n所属类：&quot; + signature.getDeclaringType());</span><br><span class="line">		Object[] args = point.getArgs();</span><br><span class="line">		logger.info(&quot;参数是：&quot; + JSON.toJSONString(args));</span><br><span class="line">		logger.info(&quot;被织入的对象是：&quot; + point.getTarget());</span><br><span class="line">		logger.info(&quot;EEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 返回后通知：在连接点正常执行完后执行的通知</span><br><span class="line">	 */</span><br><span class="line">	@AfterReturning(&quot;logaa1()&quot;)</span><br><span class="line">	public void afterReturningAdvice() &#123;</span><br><span class="line">		logger.info(&quot;LoggerHandlerAop.afterReturningAdvice...time:&quot; + DateUtil.now());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 抛出异常后通知：在连接节点抛出异常退出时执行的通知</span><br><span class="line">	 */</span><br><span class="line">	@AfterThrowing(&quot;logaa1()&quot;)</span><br><span class="line">	public void afterThrowingAdvice() &#123;</span><br><span class="line">		logger.info(&quot;LoggerHandlerAop.afterThrowingAdvice...time:&quot; + DateUtil.now());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 后置通知：当某连接节点退出的时候执行的通知（不论是正常返回还是异常退出）</span><br><span class="line">	 */</span><br><span class="line">	@After(&quot;logaa1()&quot;)</span><br><span class="line">	public void afterFinallyAdvice() &#123;</span><br><span class="line">		logger.info(&quot;LoggerHandlerAop.afterFinallyAdvice...time:&quot; + DateUtil.now());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 环绕通知：包围一个连接点（join point）的通知</span><br><span class="line">	 * </span><br><span class="line">	 * @param pjp</span><br><span class="line">	 * @return</span><br><span class="line">	 */</span><br><span class="line">	@Around(&quot;logaa1()&quot;)</span><br><span class="line">	public Object aroundAdvice(ProceedingJoinPoint pjp) &#123;</span><br><span class="line">		logger.info(&quot;LoggerHandlerAop.aroundAdvice...time:&quot; + DateUtil.now());</span><br><span class="line">		Object obj = null;</span><br><span class="line">		try &#123;</span><br><span class="line">			System.out.println(&quot;MoocAspect around 1.&quot;);</span><br><span class="line">			obj = pjp.proceed();</span><br><span class="line">			System.out.println(&quot;MoocAspect around 2.&quot;);</span><br><span class="line">		&#125; catch (Throwable e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		return obj;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/23/Spring注解驱动/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason.Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/23/Spring注解驱动/" itemprop="url">Spring注解驱动</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-23T10:47:19+08:00">
                2018-07-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring/" itemprop="url" rel="index">
                    <span itemprop="name">Spring</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Spring注解驱动"><a href="#Spring注解驱动" class="headerlink" title="Spring注解驱动"></a>Spring注解驱动</h1><p>[TOC]</p>
<h2 id="组件注册"><a href="#组件注册" class="headerlink" title="组件注册"></a>组件注册</h2><h3 id="创建并启动支持注解驱动的ioc容器"><a href="#创建并启动支持注解驱动的ioc容器" class="headerlink" title="创建并启动支持注解驱动的ioc容器"></a>创建并启动支持注解驱动的ioc容器</h3><p>通过xml配置的方式，我们要创建和启动ioc容器是通过ClassPathXmlApplicationContext类，而如果要支持注解驱动的ioc容器，我们需要使用AnnotationConfigApplicationContext类</p>
<p> AnnotationConfigApplicationContext的构造参数可以指定需要装配的标注了Spring注解的类。</p>
<p> 通常情况下我们使用一个统一的配置类就可以了，这个统一的配置类标注了很多的Spring支持的注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//装配标注了@Configuration注解的类(这个类中可以包含很多spring支持的注解，只要是spring注解它都认)</span></span><br><span class="line">AnnotationConfigApplicationContext context = <span class="keyword">new</span> AnnotationConfigApplicationContext(MyConfig.class);<span class="comment">//MyConfig是一个标示@Configuration的类，而@Configuration注解包含了@Component注解</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//指定装配标注了@Component,@Service,@Controller,@Repository注解的类</span></span><br><span class="line">AnnotationConfigApplicationContext context=<span class="keyword">new</span> AnnotationConfigApplicationContext(MyComponent.class,MyService.class,MyController.class,MyRepository.class);</span><br></pre></td></tr></table></figure>
<h3 id="Configuration-amp-Bean给容器中注册组件"><a href="#Configuration-amp-Bean给容器中注册组件" class="headerlink" title="@Configuration&amp;@Bean给容器中注册组件"></a>@Configuration&amp;@Bean给容器中注册组件</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span> <span class="comment">//定义一个配置，类似一个spring中application-context配置文件</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"myBean"</span>) <span class="comment">// 定义一个bean,bean的名称默认为方法名，也可以通过name属性指定bean的名称</span></span><br><span class="line">    <span class="meta">@Scope</span></span><br><span class="line">    <span class="comment">//singleton：单实例。默认bean的scope为singleton，IOC容器启动会调用方法创建对象并放到IOC容器中，以后每次获取就是直接从容器中拿</span></span><br><span class="line">    <span class="comment">//prototype：多实例。ioc容器启动并不会去调用方法创建对象放在容器中，而是我们每次获取的时候才会调用方法创建对象</span></span><br><span class="line">    <span class="comment">//request:同一次请求创建一个实例</span></span><br><span class="line">    <span class="comment">//session：同一个session创建一个实例</span></span><br><span class="line">    <span class="meta">@Lazy</span></span><br><span class="line">    <span class="comment">//懒加载：单实例bean，默认在容器启动时创建对象。所谓的懒加载就是：容器启动的时候不创建对象，而是在第一次获取Bean的时候创建对象并初始化</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MyBean <span class="title">createMyBean</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"给容器中添加 MyBean。。。"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MyBean();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanAssemblyApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">       <span class="comment">// AnnotationConfigApplicationContext的构造参数可以指定需要加载的注解类(一般情况下，我们指定的是一个标注了@Configuration注解的类，当然我们可以将我们需要装配的类一一指定)</span></span><br><span class="line">        AnnotationConfigApplicationContext context = <span class="keyword">new</span> AnnotationConfigApplicationContext(MyConfig.class);<span class="comment">//MyConfig是一个标示@Configuration的类，而@Configuration注解包含了@Component注解</span></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"容器创建完成。。。"</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(context.getBean(MyBean.class));</span><br><span class="line"><span class="comment">//        System.out.println(context.getBean("createMyBean"));</span></span><br><span class="line">        System.out.println(context.getBean(<span class="string">"myBean"</span>));</span><br><span class="line">        context.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ComponentScan-自动扫描组件-amp-指定扫描规则"><a href="#ComponentScan-自动扫描组件-amp-指定扫描规则" class="headerlink" title="@ComponentScan-自动扫描组件&amp;指定扫描规则"></a>@ComponentScan-自动扫描组件&amp;指定扫描规则</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(</span><br><span class="line">        basePackages = &#123;<span class="string">"com.learningcenter.spring4.bean.scanbasepackagebean.componentscan"</span>&#125;, <span class="comment">//基于指定的包路径扫描</span></span><br><span class="line">        excludeFilters = &#123;<span class="meta">@ComponentScan</span>.Filter(type = FilterType.ASSIGNABLE_TYPE, classes = &#123;MyService.class&#125;)&#125;, <span class="comment">//排除某些类</span></span><br><span class="line">        includeFilters = &#123;</span><br><span class="line">                <span class="meta">@ComponentScan</span>.Filter(type = FilterType.ANNOTATION, classes = &#123;Controller.class&#125;),</span><br><span class="line">                <span class="meta">@ComponentScan</span>.Filter(type = FilterType.CUSTOM, classes = &#123;MyTypeFilter.class&#125;)</span><br><span class="line">        &#125;,</span><br><span class="line">        useDefaultFilters = <span class="keyword">false</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line"><span class="comment">//ComponentScan：value指定扫描的包</span></span><br><span class="line"><span class="comment">//excludeFilters=Filter[],指定扫描的时候按照什么规则排除哪些组件</span></span><br><span class="line"><span class="comment">//includeFilter=Filter[]，指定扫描的时候只需要包含哪些组件</span></span><br><span class="line"><span class="comment">//useDefaultFilters：默认为true，如果为true的话，表示使用默认的扫描策略（默认扫描@Component,@Service,@Controller,@Reponsitory这些注解）。一般情况下在设置context:exclude-filter或者context:include-filter的时候，我们将useDefaultFilters设置为false</span></span><br><span class="line"><span class="comment">//FilterType.ASSIGNABLE_TYPE：按照给定的类型</span></span><br><span class="line"><span class="comment">//FilterType.ANNOTATION:按照注解</span></span><br><span class="line"><span class="comment">//FilterType.REGEX：按照正则表达式</span></span><br><span class="line"><span class="comment">//FilterType.ASPECTJ:使用ASPECTJ表达式</span></span><br><span class="line"><span class="comment">//FilterTYpe.CUSTOM:使用自定义规则</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AnnotationScanConfig</span></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRepository</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span> <span class="comment">//默认@Component的名称为类名首字母小写，也就是MyComponent</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span> <span class="comment">// 可以指定@Service的名称，默认为类名首字母小写</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyService</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyController</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTypeFilter</span> <span class="keyword">implements</span> <span class="title">TypeFilter</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> metadataReader 读取到的当前正在扫描的类的信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> metadataReaderFactory 可以获取到其他任何类信息的</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">match</span><span class="params">(MetadataReader metadataReader, MetadataReaderFactory metadataReaderFactory)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//获取当前类注解的信息</span></span><br><span class="line">        AnnotationMetadata annotationMetadata = metadataReader.getAnnotationMetadata();</span><br><span class="line">        <span class="comment">//获取当前正在扫描的类的信息</span></span><br><span class="line">        ClassMetadata classMetadata = metadataReader.getClassMetadata();</span><br><span class="line">        <span class="comment">//获取当前类的资源信息(比如：类的路径)</span></span><br><span class="line">        Resource resource =  metadataReader.getResource();</span><br><span class="line"></span><br><span class="line">        String className = classMetadata.getClassName();</span><br><span class="line">        System.out.println(<span class="string">"----&gt;"</span>+className);</span><br><span class="line">        <span class="keyword">if</span>(className.contains(<span class="string">"Component"</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        AnnotationConfigApplicationContext context=<span class="keyword">new</span> AnnotationConfigApplicationContext(AnnotationScanConfig.class);</span><br><span class="line">        System.out.println(context.getBean(MyComponent.class));</span><br><span class="line">        System.out.println(context.getBean(<span class="string">"myComponent"</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//        System.out.println(context.getBean(MyService.class));//因为在扫描中排除了MyService，所以这里肯定是取不到的</span></span><br><span class="line"><span class="comment">//        System.out.println(context.getBean("myService"));</span></span><br><span class="line"></span><br><span class="line">        System.out.println(context.getBean(MyController.class));</span><br><span class="line">        System.out.println(context.getBean(<span class="string">"myController"</span>));</span><br><span class="line"></span><br><span class="line">        context.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Conditional-按照条件注册bean"><a href="#Conditional-按照条件注册bean" class="headerlink" title="@Conditional-按照条件注册bean"></a>@Conditional-按照条件注册bean</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span>  <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String name, <span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Person&#123;"</span> +</span><br><span class="line">                <span class="string">"name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", age="</span> + age +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OSXCondition</span> <span class="keyword">implements</span> <span class="title">Condition</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> conditionContext  判断条件能使用的上下文（环境）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> annotatedTypeMetadata 标注了Condition注解的注释信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">matches</span><span class="params">(ConditionContext conditionContext, AnnotatedTypeMetadata annotatedTypeMetadata)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1.能获取到ioc使用的beanFactory</span></span><br><span class="line">        ConfigurableListableBeanFactory beanFactory = conditionContext.getBeanFactory();</span><br><span class="line">        <span class="comment">//2.能获取到classLoader</span></span><br><span class="line">        ClassLoader classLoader = conditionContext.getClassLoader();</span><br><span class="line">        <span class="comment">//3.能获取当前环境信息</span></span><br><span class="line">        Environment environment = conditionContext.getEnvironment();</span><br><span class="line">        <span class="comment">//4.能获取到bean定义的注册器</span></span><br><span class="line">        BeanDefinitionRegistry beanDefinitionRegistry = conditionContext.getRegistry();</span><br><span class="line">        <span class="comment">//5.能获取到资源加载器</span></span><br><span class="line">        ResourceLoader resourceLoader = conditionContext.getResourceLoader();</span><br><span class="line"></span><br><span class="line">        String property = environment.getProperty(<span class="string">"os.name"</span>);</span><br><span class="line">        System.out.println(<span class="string">"---&gt;"</span>+property);</span><br><span class="line">        <span class="keyword">if</span>(property.contains(<span class="string">"OS X"</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WindowsCondition</span> <span class="keyword">implements</span> <span class="title">Condition</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> conditionContext  判断条件能使用的上下文（环境）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> annotatedTypeMetadata 标注了Condition注解的注释信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">matches</span><span class="params">(ConditionContext conditionContext, AnnotatedTypeMetadata annotatedTypeMetadata)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1.能获取到ioc使用的beanFactory</span></span><br><span class="line">        ConfigurableListableBeanFactory beanFactory = conditionContext.getBeanFactory();</span><br><span class="line">        <span class="comment">//2.能获取到classLoader</span></span><br><span class="line">        ClassLoader classLoader = conditionContext.getClassLoader();</span><br><span class="line">        <span class="comment">//3.能获取当前环境信息</span></span><br><span class="line">        Environment environment = conditionContext.getEnvironment();</span><br><span class="line">        <span class="comment">//4.能获取到bean定义的注册器</span></span><br><span class="line">        BeanDefinitionRegistry beanDefinitionRegistry = conditionContext.getRegistry();</span><br><span class="line">        <span class="comment">//5.能获取到资源加载器</span></span><br><span class="line">        ResourceLoader resourceLoader = conditionContext.getResourceLoader();</span><br><span class="line"></span><br><span class="line">        String property = environment.getProperty(<span class="string">"os.name"</span>);</span><br><span class="line">        System.out.println(<span class="string">"---&gt;"</span>+property);</span><br><span class="line">        <span class="keyword">if</span>(property.contains(<span class="string">"windows"</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"bill"</span>)</span><br><span class="line">    <span class="meta">@Conditional</span>(&#123;WindowsCondition.class&#125;)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Person <span class="title">person1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Person(<span class="string">"Bill Gates"</span>,<span class="number">62</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"jobs"</span>)</span><br><span class="line">    <span class="meta">@Conditional</span>(&#123;OSXCondition.class&#125;)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Person <span class="title">person2</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Person(<span class="string">"steven jobs"</span>,<span class="number">39</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        AnnotationConfigApplicationContext context = <span class="keyword">new</span> AnnotationConfigApplicationContext(MyConfiguration.class);</span><br><span class="line"></span><br><span class="line">        Person linus = (Person) context.getBean(<span class="string">"jobs"</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(linus);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 运行后我们发现bill这个bean获取不到，那是因为如果在mac osx系统下，bill这个bean不会被装配(不满足条件，所以没有装配)</span></span><br><span class="line">        Person bill = (Person) context.getBean(<span class="string">"bill"</span>); </span><br><span class="line"></span><br><span class="line">        System.out.println(bill);</span><br><span class="line"></span><br><span class="line">        context.close();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>@Conditional注解不但可以标注在方法上，也可以标注在类上，如果标注在类上表示满足条件，那么类中配置的所有bean才能生效</p>
<h3 id="Import-给容器中快速导入一系列组件"><a href="#Import-给容器中快速导入一系列组件" class="headerlink" title="@Import-给容器中快速导入一系列组件"></a>@Import-给容器中快速导入一系列组件</h3><p>给容器中注册组件：</p>
<ol>
<li><p>包扫描+组件标注注解(@Controller/@Service/@Component/@Repository) ,针对自己写的类</p>
</li>
<li><p>@Bean，针对第三方包里面的类，如果我们需要将这些类放到容器中，我们需要使用@Bean</p>
</li>
<li><p>@Import，快速的给容器中导入一系列组件</p>
<ul>
<li>@Import(要导入到容器的组件)，容器中就会自动注册这个组件，id默认为类的全限定名</li>
<li>ImportSelector：通过使用@Import导入一个自定义的ImportSelector实现类，然后会调用这个实现类的selectImports方法，该方法返回一系列类名，这些类名对应的一系列类将被注册到容器中。(注意此时，自定义的ImportSelector实现类不会被注册到容器中)   </li>
<li>ImportBeanDefinitionRegistrar：通过使用@Import导入一个自定义的ImportBeanDefinitionRegistrar实现类，然后会调用这个实现类的registerBeanDefinitions方法去完成手动注册一系列bean(注意此时，自定义的ImportBeanDefinitionRegistrar实现类不会被注册到容器中)   </li>
</ul>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Address</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Color</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String name, <span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Person&#123;"</span> +</span><br><span class="line">                <span class="string">"name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", age="</span> + age +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Import</span>(&#123;Address.class,Color.class&#125;) <span class="comment">//导入指定的类，这些类将作为Bean被装配到容器中。Bean的id为类的全限定名</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfiguration</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Person <span class="title">person</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Person(<span class="string">"Jason"</span>,<span class="number">33</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        AnnotationConfigApplicationContext context = <span class="keyword">new</span> AnnotationConfigApplicationContext(MyConfiguration.class);</span><br><span class="line"></span><br><span class="line">        Stream.of(context.getBeanDefinitionNames()).forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">        context.close();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Import-使用ImportSelector"><a href="#Import-使用ImportSelector" class="headerlink" title="@Import-使用ImportSelector"></a>@Import-使用ImportSelector</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Address</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Color</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyImportSelector</span> <span class="keyword">implements</span> <span class="title">ImportSelector</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> annotationMetadata 当前标注<span class="doctag">@Import</span>注解的类的所有注解信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 要导入到容器中的组件全类名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String[] selectImports(AnnotationMetadata annotationMetadata) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> String[]&#123;<span class="string">"com.learningcenter.spring4.extanal.importbean.Address"</span>,<span class="string">"com.learningcenter.spring4.extanal.importbean.Color"</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Import</span>(&#123;MyImportSelector.class&#125;) </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        AnnotationConfigApplicationContext context = <span class="keyword">new</span> AnnotationConfigApplicationContext(MyConfiguration.class);</span><br><span class="line"></span><br><span class="line">        Stream.of(context.getBeanDefinitionNames()).forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">        context.close();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Import-使用ImportBeanDefinitionRegistrar"><a href="#Import-使用ImportBeanDefinitionRegistrar" class="headerlink" title="@Import-使用ImportBeanDefinitionRegistrar"></a>@Import-使用ImportBeanDefinitionRegistrar</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Color</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyImportBeanDefinitionRegistrar</span> <span class="keyword">implements</span> <span class="title">ImportBeanDefinitionRegistrar</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> annotationMetadata 当前类的注解信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> beanDefinitionRegistry bean定义注册器</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 把所有需要添加到容器中的bean，调用beanDefinitionRegistry.registerBeanDefinition()方法手工注册进来</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerBeanDefinitions</span><span class="params">(AnnotationMetadata annotationMetadata, BeanDefinitionRegistry beanDefinitionRegistry)</span> </span>&#123;</span><br><span class="line">        BeanDefinition beanDefinition = <span class="keyword">new</span> RootBeanDefinition(Color.class);</span><br><span class="line">        beanDefinitionRegistry.registerBeanDefinition(<span class="string">"color"</span>,beanDefinition);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Import</span>(&#123;MyImportBeanDefinitionRegistrar.class&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        AnnotationConfigApplicationContext context = <span class="keyword">new</span> AnnotationConfigApplicationContext(MyConfiguration.class);</span><br><span class="line"></span><br><span class="line">        Stream.of(context.getBeanDefinitionNames()).forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">        context.close();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="使用FactoryBean注册组件"><a href="#使用FactoryBean注册组件" class="headerlink" title="使用FactoryBean注册组件"></a>使用FactoryBean注册组件</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 描述:</span></span><br><span class="line"><span class="comment"> *  FactoryBean主要用来产生Bean</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Jason</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@email</span> 285290078@qq.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2018-05-10 12:23</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFactoryBean</span> <span class="keyword">implements</span> <span class="title">FactoryBean</span>&lt;<span class="title">MyBean</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MyBean <span class="title">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MyBean();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">        <span class="keyword">return</span> MyBean.class;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSingleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span> <span class="comment">//定义一个配置，类似一个spring中application-context配置文件</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FactoryBeanConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"myBean"</span>) <span class="comment">// 定义一个bean,bean的名称默认为方法名，也可以通过name属性指定bean的名称</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MyFactoryBean <span class="title">createMyFactoryBean</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MyFactoryBean();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FactoryBeanApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        AnnotationConfigApplicationContext context = <span class="keyword">new</span> AnnotationConfigApplicationContext(FactoryBeanConfig.class);</span><br><span class="line">        <span class="comment">//获取通过factorybean创建的bean</span></span><br><span class="line">        System.out.println(context.getBean(MyBean.class));</span><br><span class="line">        System.out.println(context.getBean(<span class="string">"myBean"</span>));</span><br><span class="line">        <span class="comment">//获取factorybean本身</span></span><br><span class="line">        System.out.println(context.getBean(MyFactoryBean.class));</span><br><span class="line">        System.out.println(context.getBean(<span class="string">"&amp;myBean"</span>));</span><br><span class="line">        context.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="工厂实例化Bean"><a href="#工厂实例化Bean" class="headerlink" title="工厂实例化Bean"></a>工厂实例化Bean</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 描述:</span></span><br><span class="line"><span class="comment"> *  MyBeanFactory用来实例化一个bean</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Jason</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@email</span> 285290078@qq.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2018-05-10 13:04</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBeanFactory</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> MyBean <span class="title">create</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MyBean();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InstantiationBeanFactoryConfig</span> </span>&#123;</span><br><span class="line">    <span class="comment">//创建一个工厂bean实例</span></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"myBeanFactory"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> MyBeanFactory <span class="title">createMyBeanFactory</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MyBeanFactory();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//通过一个工厂bean实例创建一个Bean实例</span></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"myBean"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> MyBean <span class="title">createMyBean</span><span class="params">(MyBeanFactory myBeanFactory)</span></span>&#123; <span class="comment">//在bean的装配过程中，如果需要参数的话，spring默认会去spring容器中获取到对应的参数然后注入进来</span></span><br><span class="line">        <span class="keyword">return</span> myBeanFactory.create();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InstantiationBeanFactoryApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        AnnotationConfigApplicationContext context = <span class="keyword">new</span> AnnotationConfigApplicationContext(InstantiationBeanFactoryConfig.class);</span><br><span class="line">        <span class="comment">//获取bean工厂实例</span></span><br><span class="line">        System.out.println(context.getBean(MyBeanFactory.class));</span><br><span class="line">        System.out.println(context.getBean(<span class="string">"myBeanFactory"</span>));</span><br><span class="line">        <span class="comment">//获取bean实例</span></span><br><span class="line">        System.out.println(context.getBean(MyBean.class));</span><br><span class="line">        System.out.println(context.getBean(<span class="string">"myBean"</span>));</span><br><span class="line">        context.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="静态工厂实例化Bean"><a href="#静态工厂实例化Bean" class="headerlink" title="静态工厂实例化Bean"></a>静态工厂实例化Bean</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">public class MyBean &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public class StaticBeanFactory &#123;</span><br><span class="line">    public static MyBean create()&#123;</span><br><span class="line">        return new MyBean();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@Configuration</span><br><span class="line">public class StaticFactoryBeanConfig &#123;</span><br><span class="line">    //通过一个静态工厂创建一个bean实例</span><br><span class="line">    @Bean(&quot;myBean&quot;)</span><br><span class="line">    public MyBean createMyBean()&#123;</span><br><span class="line">        return StaticBeanFactory.create();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class StaticBeanFactoryApplication &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        AnnotationConfigApplicationContext context = new AnnotationConfigApplicationContext(StaticFactoryBeanConfig.class);</span><br><span class="line">        System.out.println(context.getBean(MyBean.class));</span><br><span class="line">        System.out.println(context.getBean(&quot;myBean&quot;));</span><br><span class="line">        context.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h2><h3 id="bean的生命周期"><a href="#bean的生命周期" class="headerlink" title="bean的生命周期"></a>bean的生命周期</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> <span class="keyword">implements</span> <span class="title">BeanFactoryAware</span>, <span class="title">BeanNameAware</span>,</span></span><br><span class="line"><span class="class">        <span class="title">InitializingBean</span>, <span class="title">DisposableBean</span>,<span class="title">ApplicationContextAware</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> phone;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> BeanFactory beanFactory;</span><br><span class="line">    <span class="keyword">private</span> String beanName;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"【构造器】调用Person的构造器实例化"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"【注入属性】注入属性name"</span>);</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAddress</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAddress</span><span class="params">(String address)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"【注入属性】注入属性address"</span>);</span><br><span class="line">        <span class="keyword">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPhone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> phone;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPhone</span><span class="params">(<span class="keyword">int</span> phone)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"【注入属性】注入属性phone"</span>);</span><br><span class="line">        <span class="keyword">this</span>.phone = phone;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Person [address="</span> + address + <span class="string">", name="</span> + name + <span class="string">", phone="</span></span><br><span class="line">                + phone + <span class="string">"]"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这是BeanFactoryAware接口方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBeanFactory</span><span class="params">(BeanFactory arg0)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        System.out</span><br><span class="line">                .println(<span class="string">"【BeanFactoryAware接口】调用BeanFactoryAware.setBeanFactory()"</span>);</span><br><span class="line">        <span class="keyword">this</span>.beanFactory = arg0;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 这是ApplicationContextAware接口方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"【ApplicationContextAware接口】调用ApplicationContextAware.setApplicationContext()"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这是BeanNameAware接口方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBeanName</span><span class="params">(String arg0)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"【BeanNameAware接口】调用BeanNameAware.setBeanName()"</span>);</span><br><span class="line">        <span class="keyword">this</span>.beanName = arg0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postConstruct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"----postConstruct Person----"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PreDestroy</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preDestroy</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"----preDestroy Person----"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这是InitializingBean接口方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out</span><br><span class="line">                .println(<span class="string">"【InitializingBean接口】调用InitializingBean.afterPropertiesSet()"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这是DiposibleBean接口方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"【DiposibleBean接口】调用DiposibleBean.destory()"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 通过&lt;bean&gt;的init-method属性指定的初始化方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myInit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"【init-method】调用&lt;bean&gt;的init-method属性指定的初始化方法"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 通过&lt;bean&gt;的destroy-method属性指定的初始化方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myDestory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"【destroy-method】调用&lt;bean&gt;的destroy-method属性指定的初始化方法"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBeanFactoryPostProcessor</span> <span class="keyword">implements</span> <span class="title">BeanFactoryPostProcessor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyBeanFactoryPostProcessor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        System.out.println(<span class="string">"这是BeanFactoryPostProcessor实现类构造器！！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postProcessBeanFactory</span><span class="params">(ConfigurableListableBeanFactory arg0)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        System.out</span><br><span class="line">                .println(<span class="string">"BeanFactoryPostProcessor调用postProcessBeanFactory方法"</span>);</span><br><span class="line">        BeanDefinition bd = arg0.getBeanDefinition(<span class="string">"person"</span>);</span><br><span class="line">        bd.getPropertyValues().addPropertyValue(<span class="string">"phone"</span>, <span class="string">"110"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//BeanDefinition beanDefinition = BeanDefinitionBuilder.genericBeanDefinition(Person.class).getBeanDefinition();//通过BeanDefinitionBuilder生成一个Bean的定义</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInstantiationAwareBeanPostProcessor</span> <span class="keyword">extends</span></span></span><br><span class="line"><span class="class">        <span class="title">InstantiationAwareBeanPostProcessorAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyInstantiationAwareBeanPostProcessor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        System.out</span><br><span class="line">                .println(<span class="string">"这是InstantiationAwareBeanPostProcessorAdapter实现类构造器！！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 接口方法、实例化Bean之前调用</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">postProcessBeforeInstantiation</span><span class="params">(Class beanClass,</span></span></span><br><span class="line"><span class="function"><span class="params">            String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        System.out</span><br><span class="line">                .println(<span class="string">"InstantiationAwareBeanPostProcessor调用postProcessBeforeInstantiation方法"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 接口方法、实例化Bean之后调用</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        System.out</span><br><span class="line">                .println(<span class="string">"InstantiationAwareBeanPostProcessor调用postProcessAfterInitialization方法"</span>);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 接口方法、设置某个属性时调用</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PropertyValues <span class="title">postProcessPropertyValues</span><span class="params">(PropertyValues pvs,</span></span></span><br><span class="line"><span class="function"><span class="params">            PropertyDescriptor[] pds, Object bean, String beanName)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        System.out</span><br><span class="line">                .println(<span class="string">"InstantiationAwareBeanPostProcessor调用postProcessPropertyValues方法"</span>);</span><br><span class="line">        <span class="keyword">return</span> pvs;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBeanPostProcessor</span> <span class="keyword">implements</span> <span class="title">BeanPostProcessor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyBeanPostProcessor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        System.out.println(<span class="string">"这是BeanPostProcessor实现类构造器！！"</span>);</span><br><span class="line">        <span class="comment">// TODO Auto-generated constructor stub</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">postProcessAfterInitialization</span><span class="params">(Object arg0, String arg1)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        System.out</span><br><span class="line">        .println(<span class="string">"BeanPostProcessor接口方法postProcessAfterInitialization对属性进行更改！"</span>);</span><br><span class="line">        <span class="keyword">return</span> arg0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">postProcessBeforeInitialization</span><span class="params">(Object arg0, String arg1)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        System.out</span><br><span class="line">        .println(<span class="string">"BeanPostProcessor接口方法postProcessBeforeInitialization对属性进行更改！"</span>);</span><br><span class="line">        <span class="keyword">return</span> arg0;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">//@ImportResource("classpath:config/lifecycle/beans.xml")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanLifeCycleConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"beanPostProcessor"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> MyBeanPostProcessor <span class="title">beanPostProcessor</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MyBeanPostProcessor();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"instantiationAwareBeanPostProcessor"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> MyInstantiationAwareBeanPostProcessor <span class="title">instantiationAwareBeanPostProcessor</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MyInstantiationAwareBeanPostProcessor();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"beanFactoryPostProcessor"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> MyBeanFactoryPostProcessor <span class="title">beanFactoryPostProcessor</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MyBeanFactoryPostProcessor();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(name=<span class="string">"person"</span>,initMethod =<span class="string">"myInit"</span>,destroyMethod = <span class="string">"myDestory"</span>)</span><br><span class="line">    <span class="meta">@Scope</span>(<span class="string">"singleton"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Person <span class="title">person</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Person person =  <span class="keyword">new</span> Person();</span><br><span class="line">        person.setName(<span class="string">"张三"</span>);</span><br><span class="line">        person.setAddress(<span class="string">"广州"</span>);</span><br><span class="line">        person.setPhone(<span class="number">1299131</span>);</span><br><span class="line">        <span class="keyword">return</span> person;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanLifeCycleApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"现在开始初始化容器"</span>);</span><br><span class="line"></span><br><span class="line">        AnnotationConfigApplicationContext context = <span class="keyword">new</span> AnnotationConfigApplicationContext(BeanLifeCycleConfig.class);</span><br><span class="line">        System.out.println(<span class="string">"容器初始化成功"</span>);</span><br><span class="line">        <span class="comment">//得到Preson，并使用</span></span><br><span class="line">        Person person = context.getBean(<span class="string">"person"</span>,Person.class);</span><br><span class="line">        System.out.println(person);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"现在开始关闭容器！"</span>);</span><br><span class="line">        context.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">运行发现：</span><br><span class="line"> <span class="number">1</span>. 现在开始初始化容器</span><br><span class="line"> <span class="number">2</span>. 这是BeanFactoryPostProcessor实现类构造器！！</span><br><span class="line"> <span class="number">3</span>. BeanFactoryPostProcessor调用postProcessBeanFactory方法</span><br><span class="line"> <span class="number">4</span>. 这是BeanPostProcessor实现类构造器！！</span><br><span class="line"> <span class="number">5</span>. 这是InstantiationAwareBeanPostProcessorAdapter实现类构造器！！</span><br><span class="line"> <span class="number">6</span>. InstantiationAwareBeanPostProcessor调用postProcessBeforeInstantiation方法</span><br><span class="line"> <span class="number">7</span>. InstantiationAwareBeanPostProcessor调用postProcessPropertyValues方法</span><br><span class="line"> <span class="number">8</span>. BeanPostProcessor接口方法postProcessBeforeInitialization对属性进行更改！</span><br><span class="line"> <span class="number">9</span>. BeanPostProcessor接口方法postProcessAfterInitialization对属性进行更改！</span><br><span class="line"> <span class="number">10</span>. InstantiationAwareBeanPostProcessor调用postProcessAfterInitialization方法</span><br><span class="line"> <span class="number">11</span>. InstantiationAwareBeanPostProcessor调用postProcessBeforeInstantiation方法</span><br><span class="line"> <span class="number">12</span>. InstantiationAwareBeanPostProcessor调用postProcessPropertyValues方法</span><br><span class="line"> <span class="number">13</span>. BeanPostProcessor接口方法postProcessBeforeInitialization对属性进行更改！</span><br><span class="line"> <span class="number">14</span>. BeanPostProcessor接口方法postProcessAfterInitialization对属性进行更改！</span><br><span class="line"> <span class="number">15</span>. InstantiationAwareBeanPostProcessor调用postProcessAfterInitialization方法</span><br><span class="line"> <span class="number">16</span>. InstantiationAwareBeanPostProcessor调用postProcessBeforeInstantiation方法</span><br><span class="line"> <span class="number">17</span>. 【构造器】调用Person的构造器实例化</span><br><span class="line"> <span class="number">18</span>. 【注入属性】注入属性name</span><br><span class="line"> <span class="number">19</span>. 【注入属性】注入属性address</span><br><span class="line"> <span class="number">20</span>. 【注入属性】注入属性phone</span><br><span class="line"> <span class="number">21</span>. InstantiationAwareBeanPostProcessor调用postProcessPropertyValues方法</span><br><span class="line"> <span class="number">22</span>. 【注入属性】注入属性phone</span><br><span class="line"> <span class="number">23</span>. 【BeanNameAware接口】调用BeanNameAware.setBeanName()</span><br><span class="line"> <span class="number">24</span>. 【BeanFactoryAware接口】调用BeanFactoryAware.setBeanFactory()</span><br><span class="line"> <span class="number">25</span>. 【ApplicationContextAware接口】调用ApplicationContextAware.setApplicationContext()</span><br><span class="line"> <span class="number">26</span>. BeanPostProcessor接口方法postProcessBeforeInitialization对属性进行更改！</span><br><span class="line"> <span class="number">27</span>. ----postConstruct Person----</span><br><span class="line"> <span class="number">28</span>. 【InitializingBean接口】调用InitializingBean.afterPropertiesSet()</span><br><span class="line"> <span class="number">29</span>. 【init-method】调用&lt;bean&gt;的init-method属性指定的初始化方法</span><br><span class="line"> <span class="number">30</span>. BeanPostProcessor接口方法postProcessAfterInitialization对属性进行更改！</span><br><span class="line"> <span class="number">31</span>. InstantiationAwareBeanPostProcessor调用postProcessAfterInitialization方法</span><br><span class="line"> <span class="number">32</span>. 容器初始化成功</span><br><span class="line"> <span class="number">33</span>. Person [address=广州, name=张三, phone=<span class="number">110</span>]</span><br><span class="line"> <span class="number">34</span>. 现在开始关闭容器！</span><br><span class="line"> <span class="number">35</span>. ----preDestroy Person----</span><br><span class="line"> <span class="number">36</span>. 【DiposibleBean接口】调用DiposibleBean.destory()</span><br><span class="line"> <span class="number">37</span>. 【destroy-method】调用&lt;bean&gt;的destroy-method属性指定的销毁方法</span><br></pre></td></tr></table></figure>
<p><img src="https://images0.cnblogs.com/i/580631/201405/181453414212066.png" alt=""><br><img src="https://images0.cnblogs.com/i/580631/201405/181454040628981.png" alt=""></p>
<p><strong>大致流程</strong>：</p>
<ol start="0">
<li><p>现在开始初始化容器</p>
</li>
<li><p>执行BeanDefinitionRegistryPostProcessor实现类的构造器，并先执行 postProcessBeanDefinitionRegistry方法，然后执行postProcessBeanFactory方法</p>
</li>
<li><p>BeanFactoryPostProcessor实现类的构造器 （如果有BeanFactoryPostProcessor的实现类）</p>
</li>
<li><p>调用BeanFactoryPostProcessor实现类的postProcessBeanFactory方法（如果有BeanFactoryPostProcessor的实现类）</p>
</li>
<li><p>BeanPostProcessor实现类构的造器 （如果在容器中有BeanPostProcessor实现类的Bean）</p>
</li>
<li>调用Bean的构造器实例化</li>
<li>注入属性</li>
<li>调用BeanNameAware.setBeanName方法（如果当前Bean实现了BeanNameAware接口）</li>
<li>调用BeanFactoryAware.setBeanFactory方法（如果当前Bean实现了BeanFactoryAware接口）</li>
<li>调用ApplicationContextAware.setApplicationContext方法（如果当前Bean实现了ApplicationContextAware接口）</li>
<li>调用BeanPostProcessor.postProcessBeforeInitialization方法(如果在容器中有BeanPostProcessor实现类的Bean）</li>
<li>调用bean中@PostConstruct注解的方法</li>
<li>调用InitializingBean.afterPropertiesSet方法</li>
<li>调用bean的init-method属性指定的初始化方法</li>
<li>调用BeanPostProcessor.postProcessAfterInitialization方法(如果在容器中有BeanPostProcessor实现类的Bean）</li>
<li>至此，容器初始化成功。可以成功获取bean实例，进行业务逻辑调用</li>
<li>现在开始关闭容器！</li>
<li>调用bean中@PreDestroy注解的方法</li>
<li>调用DiposibleBean.destory方法（如果bean实现了DiposibleBean接口）</li>
<li>调用bean的destroy-method属性指定的销毁方法</li>
</ol>
<p><strong>BeanDefinitionRegistry</strong></p>
<p>是Bean定义的注册中心，也就是保存中心。里面保存了所有Bean的定义。BeanFactory就是按照BeanDefinitionRegistry里面保存的Bean定义信息来创建Bean实例</p>
<p><strong>BeanFactoryPostProcessor</strong></p>
<p>BeanFactory的后置处理器，它的作用就是在BeanFactory标准初始化完毕之后做一些事情。所谓的标准初始化是指：所有的Bean已经保存加载到BeanFactory，但是bean的实例还未创建</p>
<p><strong>BeanDefinitionRegistryPostProcessor</strong></p>
<p>它继承自BeanFactoryPostProcessor，它是在所有的bean定义信息将要被加载，但是bean实例还未创建时执行。所以它的执行是在BeanFactoryPostProcessor执行之前。利用BeanDefinitionRegistryPostProcessor可以给容器中额外添加一些组件</p>
<p><strong>BeanPostProcessor</strong></p>
<p> Bean的后置处理器，它的作用就是在bean初始化前后做一些事情</p>
<p> <strong>Bean的实例化时机</strong></p>
<p> <a href="https://my.oschina.net/gongzili/blog/304692" target="_blank" rel="noopener">Bean的实例化时机</a></p>
<p> AbstractApplicationContext.refresh()–&gt;finishBeanFactoryInitialization()–&gt; beanFactory.preInstantiateSingletons()–&gt;DefaultListableBeanFactory.preInstantiateSingletons–&gt;getBean()–&gt;doGetBean()–&gt;createBean()</p>
<h2 id="基于Java-Config的依赖注入"><a href="#基于Java-Config的依赖注入" class="headerlink" title="基于Java Config的依赖注入"></a>基于Java Config的依赖注入</h2><p>如何在 JavaConfig 中声明依赖于其他 Bean 的 Bean？只需要在@Bean注解的方法的参数中指定需要的依赖类型，Spring 会自动帮你注入。</p>
<p>无论该方法依赖的 Bean 是在 JavaConfig 中声明的，还是 Xml 配置中声明的 </p>
<p>在SpringBoot中，它的自动配置功能会帮助我们自动注册一些Bean，如果我们要依赖它们，那么我们同样只需要在@Bean注解的方法的参数中指定需要的依赖类型，Spring 会自动帮你注入。比如依赖注入ApplicationContext</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line">public class User &#123;</span><br><span class="line"></span><br><span class="line">    private String name;</span><br><span class="line">    private int age;</span><br><span class="line"></span><br><span class="line">    public User(String name, int age) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">        this.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;User&#123;&quot; +</span><br><span class="line">                &quot;name=&apos;&quot; + name + &apos;\&apos;&apos; +</span><br><span class="line">                &quot;, age=&quot; + age +</span><br><span class="line">                &apos;&#125;&apos;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Car &#123;</span><br><span class="line">    private User user;</span><br><span class="line"></span><br><span class="line">    public Car() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Car(User user) &#123;</span><br><span class="line">        this.user = user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setUser(User user) &#123;</span><br><span class="line">        this.user = user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;Car&#123;&quot; +</span><br><span class="line">                &quot;user=&quot; + user +</span><br><span class="line">                &apos;&#125;&apos;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@Configuration//其实@Configuration也是一个@Component，它会作为一个组件被装配到spring容器中</span><br><span class="line">public class MyConfig &#123;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public User user()&#123;</span><br><span class="line">        return new User(&quot;zhanghua&quot;,30);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public User user1()&#123;</span><br><span class="line">        return new User(&quot;liuxia&quot;,24);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean(&quot;myUser&quot;)</span><br><span class="line">    public User user2()&#123;</span><br><span class="line">        return new User(&quot;jason&quot;,33);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public User user3()&#123;</span><br><span class="line">        return new User(&quot;hello&quot;,25);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//    @Bean</span><br><span class="line">//    public Car car0(User user111)&#123;//注意参数名称，如果参数名称对应的bean在spring容器中不存在，则会采用@Autowired按类型自动注入，而@Autowired按类型注入必须保证在容器中只有一个该类型的Bean存在，如果满足上面的条件，那么这里的参数名称可以随便取</span><br><span class="line">//        return new Car(user111);</span><br><span class="line">//    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public Car car(User user)&#123; //注入名称为&quot;user&quot;的实例</span><br><span class="line">        return new Car(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public Car car1(User user1)&#123;  //注入名称为&quot;user1&quot;的实例</span><br><span class="line">        return new Car(user1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public Car car2(User myUser)&#123;  //注入名称为&quot;myUser&quot;的实例</span><br><span class="line">        return new Car(myUser);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public Car car3(@Qualifier(&quot;user3&quot;) User myUser)&#123;  //注入名称为&quot;user3&quot;的实例,构造器注入</span><br><span class="line">        return new Car(myUser);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public Car car4(@Qualifier(&quot;user&quot;) User myUser)&#123;  //注入名称为&quot;user&quot;的实例,// setter注入</span><br><span class="line">        Car car =  new Car();</span><br><span class="line">        car.setUser(myUser);</span><br><span class="line">        return car;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public class MyApplication &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        AnnotationConfigApplicationContext context=new AnnotationConfigApplicationContext(MyConfig.class);</span><br><span class="line"></span><br><span class="line">        Car car= (Car) context.getBean(&quot;car&quot;);</span><br><span class="line">        System.out.println(car);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        Car car1= (Car) context.getBean(&quot;car1&quot;);</span><br><span class="line">        System.out.println(car1);</span><br><span class="line"></span><br><span class="line">        Car car2= (Car) context.getBean(&quot;car2&quot;);</span><br><span class="line">        System.out.println(car2);</span><br><span class="line"></span><br><span class="line">        Car car3= (Car) context.getBean(&quot;car3&quot;);</span><br><span class="line">        System.out.println(car3);</span><br><span class="line"></span><br><span class="line">        Car car4= (Car) context.getBean(&quot;car4&quot;);</span><br><span class="line">        System.out.println(car4);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Spring容器的refresh过程分析"><a href="#Spring容器的refresh过程分析" class="headerlink" title="Spring容器的refresh过程分析"></a>Spring容器的refresh过程分析</h2><ol>
<li><p>prepareRefresh();刷新前的预处理：</p>
<ol>
<li>initPropertySources();初始化一些属性设置；子类自定义个性化的属性设置方法</li>
<li>getEnviroment().validateRequiredProperties();校验属性的合法性</li>
<li>earlyApplicationEvents=new LinkedHashSet<applicationevent>();保存容器中的一些早期的事件</applicationevent></li>
</ol>
</li>
<li><p>obtainFreshBeanFactory();获取BeanFactory：</p>
<ol>
<li><p>refreshBeanFactory();刷新【创建】BeanFactory:</p>
<p>创建了一个this.beanFactory=new DefaultListableBeanFactory();</p>
<p>设置序列化id</p>
</li>
<li><p>getBeanFactory();返回刚才GenericApplicationContext创建的BeanFactory对象</p>
</li>
<li><p>将创建的BeanFactory【DefaultListableBeanFactory】 </p>
</li>
</ol>
</li>
<li><p>prepareBeanFactory(beanFactory);  BeanFactory的预准备工作（对BeanFactory进行一些设置）</p>
<ol>
<li>设置BeanFactory的类加载器、支持的表达式解析器等等</li>
<li>添加BeanPostProcessor 【ApplicationContextAwareProcessor】 </li>
<li>设置忽略的自动装配的接口【EnvironmentAware、EmbeddedValueResolverAware、ApplicationEventPublisherAware等等】</li>
<li>注册可以解析的自动装配。它让我们可以在任何组件中自动注入BeanFacotory、ResourceLoader、ApplicationEventPublisher、ApplicationContext。这些组件都是自动装配的，我们可以直接依赖注入使用</li>
<li>添加BeanPostProcessor【ApplicationListenerDetector】</li>
<li>添加编译时的AspectJ</li>
<li>给BeanFactory中注册一些能用的组件，比如：environment、systemProperties、systemEnvironment。这些组件都是自动装配的，我们可以直接依赖注入使用</li>
</ol>
</li>
<li><p>postProcessBeanFactory(beanFactory) ；BeanFactory准备工作完成之后进行的后置处理工作</p>
<ol>
<li>子类通过重写这个方法来在BeanFactory创建并预准备完成以后做进一步的设置</li>
</ol>
</li>
<li><p>invokeBeanFactoryPostProcessors(beanFactory)；执行BeanFactoryPostProcessors   </p>
<p>BeanFactoryPostProcessor：BeanFactory的后置处理器，BeanFactory标准初始化之后执行</p>
<p>两个接口：BeanFactoryPostProcessor、BeanDefinitionRegistryPostProcessor</p>
<ol>
<li><p>执行BeanFactoryPostProcessor的方法：</p>
<p>先执行BeanDefinitionRegistryPostProcessor</p>
<ol>
<li>获取所有的BeanDefinitionRegistryPostProcessor</li>
<li>先执行实现了PriorityOrder优先级接口的BeanDefinitionRegistryPostProcessor、 postProcessor.postProcessBeanDefinitionRegistry(registry);</li>
<li>再执行实现了Ordered顺序接口的BeanDefinitionRegistryPostProcessor、<br>postProcessor.postProcessBeanDefinitionRegistry(registry);</li>
<li>最后执行没有实现任何优先级或者顺序接口的BeanDefinitionRegistryPostProcessor、<br>postProcessor.postProcessBeanDefinitionRegistry(registry);</li>
</ol>
<p>再执行BeanFactoryPostProcessor的方法：</p>
<ol>
<li>获取所有的BeanFactoryPostProcessor</li>
<li>先执行实现了PriorityOrder优先级接口的BeanFactoryPostProcessor、  postProcessor.postProcessBeanFactory(beanFactory);</li>
<li>再执行实现了Ordered顺序接口的BeanFactoryPostProcessor、<br>postProcessor.postProcessBeanFactory(beanFactory);</li>
<li>最后执行没有实现任何优先级或者顺序接口的BeanFactoryPostProcessor、<br>postProcessor.postProcessBeanFactory(beanFactory);</li>
</ol>
</li>
</ol>
</li>
<li><p>registerBeanPostProcessors(beanFactory)；注册BeanPostProcessors(Bean的后置处理器，它的作用就是拦截Bean的初始化过程)      </p>
<ol>
<li>获取所有的 BeanPostProcessors，后置处理器都默认可以通过PriorityOrder、Ordered接口来指定执行优先级</li>
<li>把获取的BeanPostProcessors分类，并注册</li>
<li>beanFactory.addBeanPostProcessor(new ApplicationListenerDetector(applicationContext));添加一个ApplicationListenerDetector的BeanPostProcessor后置处理器</li>
</ol>
</li>
<li><p>initMessageSource();初始化MessageSource(做国际化功能，消息绑定，消息解析)，所以MessageSource组件是自动装配的，我们可以直接依赖注入使用</p>
<ol>
<li>获取BeanFactory</li>
<li>看容器中是否有id为messagesource的，类型为MessageSource的组件    ，如果有则从容器中获取出来赋值给messageSource，如果没有则创建一个DelegatingMessageSource实例赋值给messageSource并注册到容器中（id为messageSource）</li>
</ol>
</li>
<li><p>initApplicationEventMulticaster()；初始化ApplicationEventMulticaster。ApplicationEventMulticaster组件是自动装配的，我们可以直接依赖注入使用</p>
<ol>
<li>获取BeanFactory</li>
<li>看容器中是否有id为applicationEventMulticaster的，类型为ApplicationEventMulticaster的组件    ，如果有则从容器中获取出来赋值给applicationEventMulticaster，如果没有则创建一个SimpleApplicationEventMulticaster实例赋值给applicationEventMulticaster并注册到容器中（id为applicationEventMulticaster）</li>
</ol>
</li>
<li><p>onRefresh();留给子类容器去实现</p>
<ol>
<li>子类重写这个方法，在容器刷新的时候可以自定义逻辑，比如：EmbeddedWebApplicationContext这个子类容器就重写这个方法，主要是去创建一个内嵌的servlet容器</li>
</ol>
</li>
<li><p>registerListeners();</p>
<ol>
<li>从容器中获取所有的ApplicationListener</li>
<li>将每个监听器添加到ApplicationEventMulticaster事件广播器中</li>
<li>事件广播器广播早期保存在容器中的一些事件</li>
</ol>
</li>
<li><p>finishBeanFactoryInitialization(beanFactory);初始化所有剩下的单实例Bean</p>
<ol>
<li><p>beanFactory.preInstantiateSingletons();初始化并实例化所有剩下的单实例Bean。bean的创建-&gt;bean的属性设置值-&gt;执行Aware的对应方法-&gt;beanProcessor.postProcessBeforeInitialization方法-&gt;@PostContructor注解的方法-&gt;InitializingBean接口中的afterPropertiesSet方法-&gt;bean指定的initMethod方法-&gt;beanProcessor.postProcessAfterInitialization方法</p>
<ol>
<li>获取容器中所有bean，依次进行初始化和创建对象</li>
<li>获取Bean的定义信息，RootBeanDefinition</li>
<li><p>Bean不是抽象的、是单例的、是懒加载的：</p>
<ol>
<li>判断是否是FactoryBean，是否是实现FactoryBean接口的Bean</li>
<li><p>不是FactoryBean，那么利用getBean(beanName)；实例化Bean：</p>
<p>–&gt;doGetBean();</p>
<ol>
<li>先获取缓存中保存的单实例bean，如果能获取到说明这个bean之前被创建过(所有创建过的单实例bean都会被缓存起来)。</li>
<li>缓存中获取不到，开始Bean的实例化流程：–&gt;3</li>
<li>标记当前bean已经被创建。</li>
<li>获取bean的定义信息 </li>
<li>获取当前bean依赖的其他bean，如果有依赖的bean，那么同样通过getBean(beanName)的方式先把依赖的bean实例化 </li>
<li>启动单实例bean的创建流程：–&gt;7</li>
<li>它会通过ObjectFactory的createBean()来创建bean：–&gt;8</li>
<li>beanInstance = this.resolveBeforeInstantiation(beanName, mbdToUse);让BeanPostProcessor先拦截返回代理对象，这个BeanPostProcessor就是InstantiationAwareBeanPostProcessor，让这个提前执行，触发它的postProcessBeforeInstantiation()方法，这个方法的返回结果一旦不为null，则会触发它的applyBeanPostProcessorsAfterInitialization()方法。</li>
<li>如果InstantiationAwareBeanPostProcessor没有返回代理对象，调用beanInstance = this.doCreateBean(beanName, mbdToUse, args)方法创建bean：–&gt;10</li>
<li>instanceWrapper = this.createBeanInstance(beanName, mbd, args);创建Bean实例，利用工厂方法或者对象的构造器创建出Bean实例</li>
<li>调用this.applyMergedBeanDefinitionPostProcessors(mbd, beanType, beanName);方法，其实就是调用MergedBeanDefinitionPostProcessor的postProcessMergedBeanDefinition(mbd, beanType, beanName)方法</li>
<li><p>调用this.populateBean(beanName, mbd, instanceWrapper);为bean属性设置值</p>
<p>赋值之前：<br>拿到InstantiationAwareBeanPostProcessor后置处理器<br>postProcessAfterInstantiation();<br>拿到InstantiationAwareBeanPostProcessor后置处理器<br>postProcessPropertyValues();</p>
<p>上述步骤通过之后：<br>应用Bean属性的值，为属性利用setter方法等进行赋值<br>applyPropertyValues(beanName, mbd, bw, (PropertyValues)pvs);</p>
<ol start="13">
<li>exposedObject = this.initializeBean(beanName, exposedObject, mbd);</li>
<li>this.registerDisposableBeanIfNecessary(beanName, bean, mbd);注册DisposableBean</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<ol start="12">
<li><p>finishRefresh()//完成BeanFactory的初始化创建工作，也就是IOC容器创建完成</p>
<ol>
<li>initLifecycleProcessor();lifecycleProcessor允许我们做一些BeanFactory容器生命周期的回调</li>
</ol>
</li>
</ol>
<ol start="2">
<li><p>this.getLifecycleProcessor().onRefresh();回调BeanFactory容器生命周期的onRefresh方法</p>
</li>
<li><p>this.publishEvent((ApplicationEvent)(new ContextRefreshedEvent(this)));//给BeanFactory容器中发布一个容器刷新完成的事件</p>
</li>
<li><p>LiveBeansView.registerApplicationContext(this);</p>
</li>
</ol>
<h2 id="Servlet3-0的注解驱动和可插拔"><a href="#Servlet3-0的注解驱动和可插拔" class="headerlink" title="Servlet3.0的注解驱动和可插拔"></a>Servlet3.0的注解驱动和可插拔</h2><h3 id="Servlet3-0的基础"><a href="#Servlet3-0的基础" class="headerlink" title="Servlet3.0的基础"></a>Servlet3.0的基础</h3><p>要使用servlet3.0，那么tomcat的版本必须是tomcat7.0版本往后   </p>
<p>@WebServlet：注解一个servlet</p>
<p>@WebFilter：注解一个filter</p>
<p>@WebListener：注解一个listener</p>
<h3 id="ServletContainerInitializer"><a href="#ServletContainerInitializer" class="headerlink" title="ServletContainerInitializer"></a>ServletContainerInitializer</h3><p>当Servlet容器在启动一个web应用的时候，它会去扫描当前应用里面每一个jar包中的ServletContainerInitializer。</p>
<p>它是如何扫描的呢：</p>
<p>如果我们提供了一个ServletContainerInitializer实现类，提供了这个实现类之后，我们必须将这个实现类必须绑定在META-INF/service/javax.servlet.ServletContainerInitializer文件里面（该文件的内容就是我们提供的ServletContainerInitializer实现类的全限定类名）</p>
<p><strong>总结</strong>：</p>
<p>Servlet容器在启动一个web应用的时候，会扫描当前应用中每一个jar包里面的META-INF/service/javax.servlet.ServletContainerInitializer文件中指定的实现类，启动并运行这个实现类的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@HandlesTypes</span>(value=&#123;HelloService.class&#125;)</span><br><span class="line"><span class="comment">//@HandlesTypes 该注解可选。它的作用是：容器启动的时候会将@HandleTypes指定的这些类下面的子类(包含实现类、子接口)传递过来，这些类就是ServletContainerInitializer这个容器初始化器感兴趣的类</span></span><br><span class="line"><span class="keyword">public</span> MyServletContainerInitializer implements ServletContainerInitializer &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * web应用启动的时候，会运行onStartup方法</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> classes  容器初始化器感兴趣的所有类集合</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> servletContext 代表当前web应用的ServletContext。一个web应用对应一个ServletConext</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">onStartup</span><span class="params">(Set&lt;Class&lt;?&gt;&gt; classes, ServletContext servletContext)</span> <span class="keyword">throws</span> ServletException</span>&#123;</span><br><span class="line">      System.out.println(<span class="string">"容器初始化器感兴趣的类:"</span>);</span><br><span class="line">      <span class="keyword">for</span>(Class clazz:classes)&#123;</span><br><span class="line">        System.out.println(clazz);</span><br><span class="line">        </span><br><span class="line">        ...有了这些感兴趣的类，那么我们可以对它进行实例化，然后做一些操作</span><br><span class="line">        </span><br><span class="line">        ...有了ServletContext这个实例，我们也可以做一些操作啊，比如说往Servlet容器中添加一个servlet、filter、listener等等</span><br><span class="line">        </span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="SpringServletContainerInitializer"><a href="#SpringServletContainerInitializer" class="headerlink" title="SpringServletContainerInitializer"></a>SpringServletContainerInitializer</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">@HandlesTypes(&#123;WebApplicationInitializer.class&#125;)</span><br><span class="line">public class SpringServletContainerInitializer implements ServletContainerInitializer &#123;</span><br><span class="line">    public SpringServletContainerInitializer() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void onStartup(Set&lt;Class&lt;?&gt;&gt; webAppInitializerClasses, ServletContext servletContext) throws ServletException &#123;</span><br><span class="line">        List&lt;WebApplicationInitializer&gt; initializers = new LinkedList();</span><br><span class="line">        Iterator var4;</span><br><span class="line">        if (webAppInitializerClasses != null) &#123;</span><br><span class="line">            var4 = webAppInitializerClasses.iterator();</span><br><span class="line"></span><br><span class="line">            while(var4.hasNext()) &#123;</span><br><span class="line">                Class&lt;?&gt; waiClass = (Class)var4.next();</span><br><span class="line">                if (!waiClass.isInterface() &amp;&amp; !Modifier.isAbstract(waiClass.getModifiers()) &amp;&amp; WebApplicationInitializer.class.isAssignableFrom(waiClass)) &#123;</span><br><span class="line">                    try &#123;</span><br><span class="line">                        initializers.add((WebApplicationInitializer)waiClass.newInstance());</span><br><span class="line">                    &#125; catch (Throwable var7) &#123;</span><br><span class="line">                        throw new ServletException(&quot;Failed to instantiate WebApplicationInitializer class&quot;, var7);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (initializers.isEmpty()) &#123;</span><br><span class="line">            servletContext.log(&quot;No Spring WebApplicationInitializer types detected on classpath&quot;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            servletContext.log(initializers.size() + &quot; Spring WebApplicationInitializers detected on classpath&quot;);</span><br><span class="line">            AnnotationAwareOrderComparator.sort(initializers);</span><br><span class="line">            var4 = initializers.iterator();</span><br><span class="line"></span><br><span class="line">            while(var4.hasNext()) &#123;</span><br><span class="line">                WebApplicationInitializer initializer = (WebApplicationInitializer)var4.next();</span><br><span class="line">                initializer.onStartup(servletContext);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从上面代码来看：</p>
<p>首先SpringServletContainerInitializer类是实现了ServletContainerInitializer接口的。并且这个类在spring-web.jar包下面的META-INF/service/javax.servlet.ServletContainerInitializer文件中有指定</p>
<p>那么它会在Servlet容器启动的时候会加载并执行它的onStartup方法，并且这个方法接收一系列这个容器初始化器感兴趣的类的集合</p>
<p>这些类就是@HandlesTypes({WebApplicationInitializer.class})注解中WebApplicationInitializer接口的所有子类和子接口。比如：AbstractContextLoaderInitializer、AbstractDispatcherServletInitializer、AbstractAnnotationConfigDispatcherServletInitializer、SpringBootServletInitializer等</p>
<p>重点来看一下AbstractAnnotationConfigDispatcherServletInitializer类：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">public abstract class AbstractAnnotationConfigDispatcherServletInitializer extends AbstractDispatcherServletInitializer &#123;</span><br><span class="line">    public AbstractAnnotationConfigDispatcherServletInitializer() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">     // 该方法更像创建整个spring的根容器</span><br><span class="line">    protected WebApplicationContext createRootApplicationContext() &#123;</span><br><span class="line">        Class&lt;?&gt;[] configClasses = this.getRootConfigClasses();</span><br><span class="line">        if (!ObjectUtils.isEmpty(configClasses)) &#123;</span><br><span class="line">            AnnotationConfigWebApplicationContext rootAppContext = new AnnotationConfigWebApplicationContext();</span><br><span class="line">            rootAppContext.register(configClasses);</span><br><span class="line">            return rootAppContext;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // 该方法更像创建spring的web容器</span><br><span class="line">    protected WebApplicationContext createServletApplicationContext() &#123;</span><br><span class="line">        AnnotationConfigWebApplicationContext servletAppContext = new AnnotationConfigWebApplicationContext();</span><br><span class="line">        Class&lt;?&gt;[] configClasses = this.getServletConfigClasses();</span><br><span class="line">        if (!ObjectUtils.isEmpty(configClasses)) &#123;</span><br><span class="line">            servletAppContext.register(configClasses);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return servletAppContext;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected abstract Class&lt;?&gt;[] getRootConfigClasses();</span><br><span class="line"></span><br><span class="line">    protected abstract Class&lt;?&gt;[] getServletConfigClasses();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其实这个类中留下了2个getRootConfigClasses()和getServletConfigClasses抽象方法，以及它的父类中的一个getServletMappings抽象方法</p>
<p>所以我们可以自定义实现类来继承AbstractAnnotationConfigDispatcherServletInitializer抽象类来实现支持注解、可定制的spring-mvc web应用</p>
<p>其实我们也可以写个类来实现WebApplicationInitializer接口。具体参见spring-mvc的官方文档。</p>
<p>我们推荐使用上面的那种方式，也就是继承AbstractAnnotationConfigDispatcherServletInitializer类的方式</p>
<p>maven pom.xml文件中关于依赖scope作用范围的补充：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupid&gt;javax.servlet&lt;/groupid&gt;</span><br><span class="line">&lt;artifactid&gt;servlet-api&lt;/artifactid&gt;</span><br><span class="line">&lt;version&gt;3.0-alpha-1&lt;/version&gt;</span><br><span class="line">&lt;!--</span><br><span class="line">1.compile：默认值 他表示被依赖项目需要参与当前项目的编译，还有后续的测试，运行周期也参与其中，是一个比较强的依赖。打包的时候通常需要包含进去</span><br><span class="line"></span><br><span class="line">2.test：依赖项目仅仅参与测试相关的工作，包括测试代码的编译和执行，不会被打包，例如：junit</span><br><span class="line"></span><br><span class="line">3.runtime：表示被依赖项目无需参与项目的编译，不过后期的测试和运行周期需要其参与。与compile相比，跳过了编译而已。例如JDBC驱动，适用运行和测试阶段</span><br><span class="line"></span><br><span class="line">4.provided：打包的时候可以不用包进去，别的设施会提供。事实上该依赖理论上可以参与编译，测试，运行等周期。相当于compile，但是打包阶段做了exclude操作</span><br><span class="line"></span><br><span class="line">5.system：从参与度来说，和provided相同，不过被依赖项不会从maven仓库下载，而是从本地文件系统拿。需要添加systemPath的属性来定义路径</span><br><span class="line">--&gt;</span><br><span class="line">&lt;scope&gt;provider&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<h3 id="spring-mvc-支持注解-amp-可定制化"><a href="#spring-mvc-支持注解-amp-可定制化" class="headerlink" title="spring mvc 支持注解&amp;可定制化"></a>spring mvc 支持注解&amp;可定制化</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(value=<span class="string">"com.learningcenter"</span>,excludeFilters = &#123;</span><br><span class="line">        <span class="meta">@ComponentScan</span>.Filter(type = FilterType.ANNOTATION,classes = &#123;Controller.class&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RootConfiguration</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(value=<span class="string">"com.learningcenter"</span>,includeFilters = &#123;</span><br><span class="line">        <span class="meta">@ComponentScan</span>.Filter(type = FilterType.ANNOTATION,classes = &#123;Controller.class&#125;)</span><br><span class="line">&#125;,useDefaultFilters = <span class="keyword">false</span>)</span><br><span class="line"><span class="meta">@EnableWebMvc</span> <span class="comment">// 要定制Spring WebMvc，我们必须要添加这个注解 ，类似：&lt;mvc:annotation-drivern / &gt;</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebMvcConfiguration</span>  <span class="keyword">extends</span> <span class="title">WebMvcConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configurePathMatch</span><span class="params">(PathMatchConfigurer configurer)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.configurePathMatch(configurer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureContentNegotiation</span><span class="params">(ContentNegotiationConfigurer configurer)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.configureContentNegotiation(configurer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  配置异步支持</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> configurer</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureAsyncSupport</span><span class="params">(AsyncSupportConfigurer configurer)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;mvc:default-servlet-handler/&gt;</span></span><br><span class="line"><span class="comment">     * 将springmvc处理不了的请求交给serlvet容器，主要用来处理静态资源</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> configurer</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureDefaultServletHandling</span><span class="params">(DefaultServletHandlerConfigurer configurer)</span> </span>&#123;</span><br><span class="line">        configurer.enable();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加一些格式化处理器</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> registry</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addFormatters</span><span class="params">(FormatterRegistry registry)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加一些拦截器</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> registry</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// addPathPatterns 用于添加拦截规则</span></span><br><span class="line">        <span class="comment">// excludePathPatterns 用户排除拦截</span></span><br><span class="line">        <span class="comment">//addPathPatterns("/**")对所有请求都拦截，但是排除了/toLogin和/login请求的拦截</span></span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> MyInterceptor()).addPathPatterns(<span class="string">"/**"</span>).excludePathPatterns(<span class="string">"/toLogin"</span>,<span class="string">"/login"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 我们想自定义静态资源映射目录的话，只需重写addResourceHandlers方法即可</span></span><br><span class="line"><span class="comment">     * 通过addResourceHandler添加映射路径，然后通过addResourceLocations来指定路径</span></span><br><span class="line"><span class="comment">     * 比如：registry.addResourceHandler("/my/**").addResourceLocations("classpath:/my/");</span></span><br><span class="line"><span class="comment">     * 如果你想指定外部的目录也很简单，直接addResourceLocations指定即可</span></span><br><span class="line"><span class="comment">     * 比如： registry.addResourceHandler("/my/**").addResourceLocations("file:E:/my/");</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> registry</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addResourceHandler(<span class="string">"/my/**"</span>).addResourceLocations(<span class="string">"classpath:/my/"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 跨域路径映射配置</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> registry</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.addCorsMappings(registry);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 以前要访问一个页面需要先创建个Controller控制类，再写方法跳转到页面</span></span><br><span class="line"><span class="comment">     * 在这里配置后就不需要那么麻烦了，直接访问http://localhost:8080/toLogin就跳转到login.jsp页面了</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 类似springmvc会帮助我们去做这个跳转，但是还是要依赖于视图解析器</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> registry</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addViewController(<span class="string">"/toLogin"</span>).setViewName(<span class="string">"login"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 配置视图解析器</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> registry</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureViewResolvers</span><span class="params">(ViewResolverRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.freeMarker().prefix(<span class="string">"/views"</span>).suffix(<span class="string">".ftl"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * springmvc 参数解析器，做一些前端参数和后端命令对象属性的绑定</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> argumentResolvers</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addArgumentResolvers</span><span class="params">(List&lt;HandlerMethodArgumentResolver&gt; argumentResolvers)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.addArgumentResolvers(argumentResolvers);</span><br><span class="line">        argumentResolvers.add(<span class="keyword">new</span> HandlerMethodArgumentResolver() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supportsParameter</span><span class="params">(MethodParameter methodParameter)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Object <span class="title">resolveArgument</span><span class="params">(MethodParameter methodParameter, ModelAndViewContainer modelAndViewContainer, NativeWebRequest nativeWebRequest, WebDataBinderFactory webDataBinderFactory)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回值处理器</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> returnValueHandlers</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addReturnValueHandlers</span><span class="params">(List&lt;HandlerMethodReturnValueHandler&gt; returnValueHandlers)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.addReturnValueHandlers(returnValueHandlers);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 配置消息转换器，针对<span class="doctag">@ReponseBody</span>的消息转换器，比如：GsonHttpMessageConverter</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> converters</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.configureMessageConverters(converters);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 配置消息转换器，针对<span class="doctag">@ReponseBody</span>的消息转换器，比如：GsonHttpMessageConverter</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> converters</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">extendMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.extendMessageConverters(converters);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 配置异常处理器</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> converters</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureHandlerExceptionResolvers</span><span class="params">(List&lt;HandlerExceptionResolver&gt; exceptionResolvers)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.configureHandlerExceptionResolvers(exceptionResolvers);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyWebApplicatonInitializetor</span> <span class="keyword">extends</span> <span class="title">AbstractAnnotationConfigDispatcherServletInitializer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取根容器的配置类：spring的配置文件  父容器</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt;[] getRootConfigClasses() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Class[]&#123;RootConfiguration.class&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取web容器的配置类：spring mvc的配置文件  子容器</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt;[] getServletConfigClasses() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Class[]&#123;WebMvcConfiguration.class&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取DispatcherServlet的映射信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *  / :拦截所有请求(包括静态资源，比如js，jpg，css等等)，但是不包括*.jsp</span></span><br><span class="line"><span class="comment">     *  /*:拦截所有请求，连*.jsp页面都拦截，那么jsp页面就等不到视图解析和渲染</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> String[] getServletMappings() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> String[]&#123;<span class="string">"/"</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Servlet3-0异步请求"><a href="#Servlet3-0异步请求" class="headerlink" title="Servlet3.0异步请求"></a>Servlet3.0异步请求</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">@WebServlet(value = &quot;/asyn&quot;,asyncSupported = true)</span><br><span class="line">public class AsynServlet extends HttpServlet &#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;主线程&quot;+Thread.currentThread().getName()+&quot;开始&quot;);</span><br><span class="line">       //1.支持异步处理asyncSupported = true</span><br><span class="line"></span><br><span class="line">       //2.开启异步处理模式</span><br><span class="line">        AsyncContext asyncContext =  req.startAsync();</span><br><span class="line">       //3.业务逻辑进行异步处理，开始异步处理</span><br><span class="line">        asyncContext.start(()-&gt;&#123;</span><br><span class="line">            System.out.println(&quot;---&gt;&quot;+Thread.currentThread().getName());</span><br><span class="line">            try &#123;</span><br><span class="line">                System.out.println(&quot;子线程&quot;+Thread.currentThread().getName()+&quot;开始&quot;);</span><br><span class="line">                Thread.sleep(1000);</span><br><span class="line">                asyncContext.complete(); // 注意：一旦异步处理逻辑完成，要调用complete方法，这样才能响应数据给客户端</span><br><span class="line"></span><br><span class="line">                //获取响应并写数据到客户端</span><br><span class="line">                asyncContext.getResponse().getWriter().write(&quot;hello world!&quot;);</span><br><span class="line">                System.out.println(&quot;子线程&quot;+Thread.currentThread().getName()+&quot;结束&quot;);</span><br><span class="line">            &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; catch (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        System.out.println(&quot;主线程&quot;+Thread.currentThread().getName()+&quot;结束&quot;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="springmvc-异步请求的两种方式"><a href="#springmvc-异步请求的两种方式" class="headerlink" title="springmvc-异步请求的两种方式"></a>springmvc-异步请求的两种方式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">@Controller</span><br><span class="line">public class AsynController &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 1.如果控制器返回的是Callable对象</span><br><span class="line">     * 2.springmvc就会启动一个异步处理并且将返回的Callable对象提交给一个叫做TaskExecutor的任务执行器，并使用一个隔离的线程进行处理</span><br><span class="line">     * 3.DispatcherServlet和所有的Filter退出Servlet容器的线程，但是这个响应依然打开</span><br><span class="line">     * 4.Callable返回结果，SpringMVc将请求重新派发给容器，恢复之前的处理</span><br><span class="line">     * 5.根据Callable返回的结果，springmvc继续进行视图渲染流程等。</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    @ResponseBody</span><br><span class="line">    @RequestMapping(&quot;/asyn01&quot;)</span><br><span class="line">    public Callable&lt;String&gt; asyn01() &#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;主线程&quot; + Thread.currentThread().getName() + &quot;开始&quot;);</span><br><span class="line">        Callable&lt;String&gt; callable = () -&gt; &#123;</span><br><span class="line"></span><br><span class="line">            System.out.println(&quot;子线程&quot; + Thread.currentThread().getName() + &quot;结束&quot;);</span><br><span class="line">            TimeUnit.SECONDS.sleep(2);</span><br><span class="line">            System.out.println(&quot;子线程&quot; + Thread.currentThread().getName() + &quot;结束&quot;);</span><br><span class="line"></span><br><span class="line">            return &quot;Callable&lt;String&gt; asyn01&quot;;</span><br><span class="line">        &#125;;</span><br><span class="line">        System.out.println(&quot;主线程&quot; + Thread.currentThread().getName() + &quot;结束&quot;);</span><br><span class="line">        return callable;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 下面是采用DeferredResult的方式实现异步</span><br><span class="line">     *</span><br><span class="line">     * sender：是请求的主线程，直接返回DeferredResult</span><br><span class="line">     *</span><br><span class="line">     * receiver：是后台的子线程，子线程将处理的结果放入DeferredResult，那么主线程就可以接收到对应的数据</span><br><span class="line">     *</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line"></span><br><span class="line">    @RequestMapping(&quot;/creareOrder&quot;)</span><br><span class="line">    @ResponseBody</span><br><span class="line">    public DeferredResult&lt;Object&gt; sender()&#123;</span><br><span class="line">        DeferredResult&lt;Object&gt; deferredResult = new DeferredResult(3000L,&quot;create failure!&quot;);</span><br><span class="line">        DeferredResultQueue.save(deferredResult);</span><br><span class="line">        return deferredResult;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @RequestMapping(&quot;/receive&quot;)</span><br><span class="line">    @ResponseBody</span><br><span class="line">    public String  receiver()&#123;</span><br><span class="line">        //创建订单</span><br><span class="line"></span><br><span class="line">        String orderId=UUID.randomUUID().toString();</span><br><span class="line"></span><br><span class="line">        DeferredResult&lt;Object&gt; deferredResult = DeferredResultQueue.get();</span><br><span class="line">        deferredResult.setResult(orderId); // 消息处理者一旦将处理完毕的数据放到deferredResult中，那么发送者就可以接收到对应的数据</span><br><span class="line">        return &quot;success===&gt;&quot;+orderId;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/23/test/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason.Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/23/test/" itemprop="url">test</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-23T10:43:05+08:00">
                2018-07-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/test/" itemprop="url" rel="index">
                    <span itemprop="name">test</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/09/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason.Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/09/hello-world/" itemprop="url">Hello World</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-09T21:35:43+08:00">
                2018-07-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Jason.Zhang</p>
              <p class="site-description motion-element" itemprop="description">learningcenter</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jason.Zhang</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
